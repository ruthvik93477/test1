<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Google Drive Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="logo.jpeg" style="border-radius: 25px;">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      background-color: #f8f9fa;
      padding: 30px;
    }
    .folder, .file {
      transition: background-color 0.2s ease-in-out;
    }
    .folder:hover {
      background-color: #61f38d;
    }
    .file:hover {
      background-color: #f1f3f5;
    }
    .shortlisted-btn {
      background-color: orange !important;
      color: white !important;
    }
    
    .filters label {
      margin-right: 15px;
    }
    .wrapper {
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(40px);
      opacity: 0;
      animation: fadeInUp 1s ease forwards;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ffdde1, #ee9ca7, #6dd5ed, #2193b0);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: textShine 4s linear infinite;
      margin-bottom: 20px;
    }

    .lead {
      font-size: 1.1rem;
      font-weight: 500;
      color: #100f0f;
      letter-spacing: 0.5px;
      animation: fadeIn 2s ease-in 0.5s forwards;
      opacity: 0;
    }

    @keyframes fadeInUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    @keyframes textShine {
      to {
        background-position: 200% center;
      }
    }
    .navbar {
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-radius: 16px;
    }
    .nav-link {
      font-weight: 500;
      color: #eee6e6 !important;
      margin-right: 10px;
    }
    .nav-link:hover {
      background-color: #e9eded;
      color: #0e0e0f !important;
      border-radius: 10px;
    }
    .dropdown-menu {
      border-radius: 10px;
      border: 1px solid #eee;
    }
    .dropdown-item {
      margin-bottom: 8px;
    }
    .dropdown-item:hover {
      background-color: #121415;
      color: #e8eaed !important;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- Header -->

    <nav class="navbar navbar-expand-lg bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold text-primary" href="#">Upload</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="https://aitek-sg.onrender.com/upload/wrkng_sheets/8c0687fa-e0d8-4d97-9d29-working_sheets" target="_blank">Working Sheets</a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="https://aitek-sg.onrender.com/upload/contracts/962a3aab-bb3b-4668-944b-0db31econtracts">Contracts</a>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
              Offer Letters
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/ibm/682aab44-32ed-4a2a-a590-26d21d59ol_ibm">IBM</a></li>
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/infosys/de86f305-36b9-47ba-b9d9-99a58fcol_icp">Infosys</a></li>
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/internal/6ae517f2-1b24-4617-AITEK_0120c6dol_internal">Internal</a></li>
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/kpmg/6ae517f2-1b24-4617-AITEK_0220c6dol_kpmg">KPMG</a></li>
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/rizing/6ae517f2-1b24-4617-AITEK_0320c6dol_rizing">Rizing</a></li>

            </ul>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
              PaySlips
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/mohan/6ae517f2-1b24-4617-AITEK_ps_mohan">Mohan</a></li>
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/monica/6ae517f2-1b24-4617-AITEK_ps_monica">Monica</a></li>
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/nagarajan/6ae517f2-1b24-4617-AITEK_ps_nagaraj">Nagarajan</a></li>
              <li><a class="dropdown-item" href="https://aitek-sg.onrender.com/upload/nicolette/6ae517f2-1b24-4617-AITEK_ps_nicolette">Nicolette</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="https://aitek-sg.onrender.com/upload/templates/6ae517f2-1b24-4617-AITEK_templates">Templates</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="https://aitek-sg.onrender.com/upload/adhoc/042c7fa7-0465-4596-9e27-449cd90adhoc">Adhoc</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

    <div class="text-center mb-4 wrapper mt-5">
      <h1 class="display-5 fw-bold text-primary">
        Welcome Lakshmi Narayana!
      </h1>
      <p class="lead"><b><i>Please select the folder first and then use filters</i></b></p>
    </div>


    <!-- Folders Section -->
    <div class="mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">Available Folders</div>
        <div class="card-body" id="folders" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
      </div>
    </div>

    <!-- Files Section -->
    <div>
      <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
          <span>Files in Selected Folder</span>
          <div class="filters d-flex align-items-center">
          <label for="monthFilter" class="me-2">Month:</label>
          <select id="monthFilter" class="form-select form-select-sm me-3" style="width: 150px;">
            <option value="">All</option>
            <option value="0">January</option>
            <option value="1">February</option>
            <option value="2">March</option>
            <option value="3">April</option>
            <option value="4">May</option>
            <option value="5">June</option>
            <option value="6">July</option>
            <option value="7">August</option>
            <option value="8">September</option>
            <option value="9">October</option>
            <option value="10">November</option>
            <option value="11">December</option>
          </select>

          <label for="yearFilter" class="me-2">Year:</label>
          <select id="yearFilter" class="form-select form-select-sm" style="width: 120px;">
            <option value="">All</option>
          </select>
          <input type="text" id="searchInput" class="form-control form-control-sm mx-2" style="width: 200px;" placeholder="🔍 Search files...">
        </div>
        </div>
        <div class="card-body" id="files">
          <p class="text-muted">No folder selected.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let c = 0;
    let shortlistedSet = new Set();
    let currentFiles = [];
    let currentFolderName = '';

    function refresh() {
      location.reload();
    }

    // Fetch shortlisted IDs from server
    async function fetchShortlist() {
      const res = await fetch('/shortlist');
      const ids = await res.json();
      shortlistedSet = new Set(ids);
    }

    // Toggle shortlist for a file via backend
    async function toggleShortlist(fileId, btn) {
      const res = await fetch(`/shortlist/${fileId}`, { method: 'POST', headers: { 'Content-Type': 'application/json' } });
      const data = await res.json();
      if (data.shortlisted) {
        shortlistedSet.add(fileId);
      } else {
        shortlistedSet.delete(fileId);
      }
      updateShortlistButton(btn, data.shortlisted);
    }

    // Update button UI
    function updateShortlistButton(btn, isShortlisted) {
      btn.textContent = isShortlisted ? 'Shortlisted' : 'Shortlist';
      btn.classList.toggle('shortlisted-btn', isShortlisted);
    }

    async function loadFolders() {
      const res = await fetch('/folders');
      const folders = await res.json();
      console.log(folders);
      const foldersDiv = document.getElementById('folders');
      foldersDiv.innerHTML = '';
      folders.forEach(folder => {
        const folderBtn = document.createElement('button');
        folderBtn.className = 'btn btn-outline-primary folder';
        folderBtn.textContent = `📁 ${folder.name}`;
        folderBtn.onclick = () => loadFiles(folder.id, folder.name);
        foldersDiv.appendChild(folderBtn);
      });
    }

    async function lakshmiFolders(folderId) {
      const res = await fetch(`/folders/${folderId}`);
      const folders = await res.json();
      console.log(folders);
      const foldersDiv = document.getElementById('folders');
      foldersDiv.innerHTML = '';
      folders.forEach(folder => {
        const folderBtn = document.createElement('button');
        folderBtn.className = 'btn btn-outline-primary folder';
        folderBtn.textContent = `📁 ${folder.name}`;
        folderBtn.onclick = () => loadFiles(folder.id, folder.name);
        foldersDiv.appendChild(folderBtn);
      });
    }

 
    // Initial load
    (async () => {
      await fetchShortlist();
      lakshmiFolders('1FFY4j_MFdGz9c4r55ecGwd-ePvM0t6s4');
    })();

    
async function loadFiles(folderId, folderName) {
    const res = await fetch(`/folders/${folderId}/allFiles`);
    const files = await res.json();
    currentFiles = files;
    currentFolderName = folderName;
    renderFiles(currentFiles);
}

let selectedMonth = "";
let selectedYear = "";
let searchTerm = "";

// Setup filters & search
document.addEventListener("DOMContentLoaded", () => {
  const monthFilter = document.getElementById("monthFilter");
  const yearFilter = document.getElementById("yearFilter");
  const searchInput = document.getElementById("searchInput");

  if (monthFilter) {
    monthFilter.addEventListener("change", () => {
      selectedMonth = monthFilter.value;
      renderFiles(currentFiles);
    });
  }

  if (yearFilter) {
    yearFilter.addEventListener("change", () => {
      selectedYear = yearFilter.value;
      renderFiles(currentFiles);
    });
  }

  if (searchInput) {
    searchInput.addEventListener("input", () => {
      searchTerm = searchInput.value.toLowerCase();
      renderFiles(currentFiles);
    });
  }
});

// Populate available years dynamically
function populateYearFilter(files) {
  const yearFilter = document.getElementById("yearFilter");
  const years = [...new Set(files.map(f => new Date(f.createdTime).getFullYear()))];
  yearFilter.innerHTML = `<option value="">All</option>`;
  years.sort((a, b) => b - a).forEach(year => {
    yearFilter.innerHTML += `<option value="${year}">${year}</option>`;
  });
}

// Render files with all filters (month + year + search)
function renderFiles(files) {
  const filesDiv = document.getElementById('files');

  // update year dropdown
  populateYearFilter(files);

  let filteredFiles = files;

  // Month filter
  if (selectedMonth !== "") {
    filteredFiles = filteredFiles.filter(file => {
      const date = new Date(file.createdTime);
      return date.getMonth().toString() === selectedMonth;
    });
  }

  // Year filter
  if (selectedYear !== "") {
    filteredFiles = filteredFiles.filter(file => {
      const date = new Date(file.createdTime);
      return date.getFullYear().toString() === selectedYear;
    });
  }

  // Search filter
  if (searchTerm !== "") {
    filteredFiles = filteredFiles.filter(file =>
      file.fullPath.toLowerCase().includes(searchTerm)
    );
  }

  if (filteredFiles.length === 0) {
    filesDiv.innerHTML = `<p class="text-muted">No files match the filters/search in "<strong>${currentFolderName}</strong>".</p>`;
    return;
  }

  filesDiv.innerHTML = `<h5>📂 Files in "<strong>${currentFolderName}</strong>":</h5>`;
  filteredFiles.forEach(file => {
    const fileDiv = document.createElement('div');
    fileDiv.className = 'file p-2 border rounded my-2 bg-light d-flex align-items-center justify-content-between';

    const leftPart = document.createElement('div');
    leftPart.innerHTML = `📄 <strong>${file.fullPath}</strong>`;

    const time = document.createElement('span');
    time.innerHTML = `<br><small class="text-muted">Created: ${file.createdTime}</small>`;

    const rightPart = document.createElement('div');
    rightPart.innerHTML = `
      <a href="${file.webViewLink}" target="_blank" class="btn btn-sm btn-outline-primary me-1">View</a>
      <a href="/download/${file.id}" class="btn btn-sm btn-outline-success me-1">Download</a>
    `;
    fileDiv.appendChild(leftPart);
    fileDiv.appendChild(rightPart);

    filesDiv.appendChild(fileDiv);
  });
}

  </script>
</body>
</html>
